(()=>{"use strict";class e{partyMembers;result;constructor(e,t){this.partyMembers=e,this.result=t}render(){return void 0===this.partyMembers||null===this.partyMembers||void 0===this.result||null===this.result?"":`\n      <p>Party members: ${this.partyMembers}</p>\n      <p>Each party member receives:</p>\n      <ul>\n        ${this.result.individualLoot.map((e=>`<li><strong>${e.name}:</strong> ${e.total}</li>`)).join("")}\n      </ul>\n      <p>Remainder:</p>\n      <ul>\n        ${this.result.remainderLoot.map((e=>`<li><strong>${e.name}:</strong> ${e.total}</li>`)).join("")}\n      </ul>\n    `}}class t extends Error{constructor(e){super(e),this.name="EmptyLootException"}}class n extends Error{constructor(e){super(e),this.name="EmptyPartyException"}}const m=(e,m)=>{if(e.length<1)throw new t("There must be loot to break down");if(m<1)throw new n("There must be a party member to break loot down with.");const i={individualLoot:[],remainderLoot:[]};return e.forEach((e=>{const t=e.total%m,n=(e.total-t)/m,l={...e},r={...e};l.total=n,r.total=t,i.individualLoot.push(l),i.remainderLoot.push(r)})),i},i=(e,t)=>{if(t<=0)return 0;let n=0;for(let m=0;m<e;m++)n+=Math.floor(Math.random()*t)+1;return n},l=(e,t)=>e.find((e=>t>=e.min&&t<=e.max)),r="Copper Pieces",u="Silver Pieces",o="Electrum Pieces",a="Gold Pieces",s="Platinum Pieces",p=[{min:0,max:30,loot:[{name:r,num:5,size:6,multiplier:1},{name:u,num:0,size:0,multiplier:1},{name:o,num:0,size:0,multiplier:1},{name:a,num:0,size:0,multiplier:1},{name:s,num:0,size:0,multiplier:1}]},{min:31,max:60,loot:[{name:r,num:5,size:6,multiplier:1},{name:u,num:4,size:6,multiplier:1},{name:o,num:0,size:0,multiplier:1},{name:a,num:0,size:0,multiplier:1},{name:s,num:0,size:0,multiplier:1}]},{min:61,max:70,loot:[{name:r,num:5,size:6,multiplier:1},{name:u,num:4,size:6,multiplier:1},{name:o,num:0,size:0,multiplier:1},{name:a,num:1,size:6,multiplier:1},{name:s,num:0,size:0,multiplier:1}]},{min:71,max:95,loot:[{name:r,num:5,size:6,multiplier:1},{name:u,num:4,size:6,multiplier:1},{name:o,num:0,size:0,multiplier:1},{name:a,num:3,size:6,multiplier:1},{name:s,num:0,size:0,multiplier:1}]},{min:96,max:100,loot:[{name:r,num:5,size:6,multiplier:1},{name:u,num:4,size:6,multiplier:1},{name:o,num:0,size:0,multiplier:1},{name:a,num:3,size:6,multiplier:1},{name:s,num:1,size:6,multiplier:1}]}],c=[{min:0,max:30,loot:[{name:r,num:4,size:6,multiplier:100},{name:u,num:6,size:6,multiplier:10},{name:o,num:0,size:0,multiplier:1},{name:a,num:0,size:0,multiplier:1},{name:s,num:0,size:0,multiplier:1}]},{min:31,max:60,loot:[{name:r,num:4,size:6,multiplier:100},{name:u,num:6,size:6,multiplier:10},{name:o,num:0,size:0,multiplier:1},{name:a,num:2,size:6,multiplier:10},{name:s,num:0,size:0,multiplier:1}]},{min:61,max:70,loot:[{name:r,num:4,size:6,multiplier:100},{name:u,num:6,size:6,multiplier:10},{name:o,num:0,size:0,multiplier:1},{name:a,num:2,size:6,multiplier:10},{name:s,num:0,size:0,multiplier:1}]},{min:71,max:95,loot:[{name:r,num:4,size:6,multiplier:100},{name:u,num:6,size:6,multiplier:10},{name:o,num:0,size:0,multiplier:1},{name:a,num:4,size:6,multiplier:10},{name:s,num:1,size:6,multiplier:1}]},{min:96,max:100,loot:[{name:r,num:4,size:6,multiplier:100},{name:u,num:6,size:6,multiplier:10},{name:o,num:0,size:0,multiplier:1},{name:a,num:4,size:6,multiplier:10},{name:s,num:3,size:6,multiplier:1}]}],d=[{min:0,max:20,loot:[{name:r,num:0,size:0,multiplier:1},{name:u,num:4,size:6,multiplier:100},{name:o,num:0,size:0,multiplier:1},{name:a,num:1,size:6,multiplier:100},{name:s,num:0,size:0,multiplier:1}]},{min:21,max:35,loot:[{name:r,num:0,size:0,multiplier:1},{name:u,num:4,size:6,multiplier:100},{name:o,num:0,size:0,multiplier:1},{name:a,num:2,size:6,multiplier:100},{name:s,num:0,size:0,multiplier:1}]},{min:36,max:75,loot:[{name:r,num:0,size:0,multiplier:1},{name:u,num:6,size:0,multiplier:100},{name:o,num:0,size:0,multiplier:1},{name:a,num:2,size:6,multiplier:100},{name:s,num:1,size:6,multiplier:10}]},{min:76,max:100,loot:[{name:r,num:0,size:0,multiplier:1},{name:u,num:6,size:0,multiplier:100},{name:o,num:0,size:0,multiplier:1},{name:a,num:2,size:6,multiplier:100},{name:s,num:2,size:6,multiplier:10}]}],z=[{min:0,max:15,loot:[{name:r,num:0,size:0,multiplier:1},{name:u,num:2,size:6,multiplier:1e3},{name:o,num:0,size:0,multiplier:1},{name:a,num:8,size:6,multiplier:100},{name:s,num:0,size:0,multiplier:1}]},{min:16,max:55,loot:[{name:r,num:0,size:0,multiplier:1},{name:u,num:2,size:6,multiplier:1e3},{name:o,num:0,size:0,multiplier:1},{name:a,num:1,size:6,multiplier:1e3},{name:s,num:1,size:6,multiplier:100}]},{min:57,max:100,loot:[{name:r,num:0,size:0,multiplier:1},{name:u,num:2,size:6,multiplier:1e3},{name:o,num:0,size:0,multiplier:1},{name:a,num:1,size:6,multiplier:1e3},{name:s,num:2,size:6,multiplier:100}]}],b=e=>{const{multiplier:t,name:n,num:m,size:l}=e;return{name:n,total:i(m,l)*t}};class h{el;partyMembers;loot;onSubmit;constructor(e,t,n){this.el=null,this.loot=t,this.partyMembers=e,this.onSubmit=n}getRandomLootCrFromHtml(){const e=this.el?.querySelector('[name="random-loot-cr-field"]'),t=Number(e?.value);return Number.isNaN(t)?0:t}getRandomLootPartyMembersFromHtml(){const e=this.el?.querySelector('[name="random-loot-party-members-field"]'),t=Number(e?.value);return Number.isNaN(t)?0:t}getPartyMembersFromHtml(){const e=this.el?.querySelector('[name="party-members"]'),t=Number(e?.value);return Number.isNaN(t)?0:t}getLootFromHtml(){const e=this.el?.querySelectorAll(".currency-item")||[],t=[];if(!e.length)return t;for(let n=0;n<e.length;n++){const m=e[n].getElementsByTagName("label")[0].textContent?.trim()??"",i=Number(e[n].getElementsByTagName("input")[0].value)??0;t.push({name:m,total:i})}return t}registerAddButton(){const e=this.el?.querySelector('[name="add-currency-button"]');e&&e.addEventListener("click",(e=>{e.preventDefault(),this.partyMembers=this.getPartyMembersFromHtml(),this.loot=this.getLootFromHtml();const t=this.el?.querySelector("#new-currency-item-field");if(!t)return;const n=t.value;this.loot.push({name:n,total:0}),this.render()}))}registerRandomLootButton(){const e=this.el?.querySelector('[name="submit-random-loot"]');e&&e.addEventListener("click",(e=>{e.preventDefault();const t=this.getRandomLootCrFromHtml(),n=this.getRandomLootPartyMembersFromHtml(),r=(e=>{const t=i(1,100);return e<=4?l(p,t)?.loot.map(b)??[]:e<=10?l(c,t)?.loot.map(b)??[]:e<=16?l(d,t)?.loot.map(b)??[]:l(z,t)?.loot.map(b)??[]})(t),u=m(r,n);this.onSubmit(n,u)}))}registerSubmitButton(){const e=this.el?.querySelector('[name="submit-calculate"]');e&&e.addEventListener("click",(e=>{e.preventDefault();const t=this.getLootFromHtml(),n=this.getPartyMembersFromHtml(),i=m(t,n);this.onSubmit(n,i)}))}getLootItem(e){const{name:t,total:n}=e;return`\n      <div class="currency-item">\n        <label for="${t}">\n          ${t}\n        </label>\n        <input\n          type="number"\n          value="${n}"/>\n      </div>\n    `}getLootList(){return this.loot.map((e=>this.getLootItem(e))).join("")}render(){if(void 0===this.partyMembers||null===this.partyMembers||void 0===this.loot||null===this.loot||!this.loot.length||!this.el)return;const e=`\n      <div>\n        <h2>Currency Breakdown</h2>\n        <form>\n          <div>\n            <label for="party-members">\n              Party Members\n            </label>\n            <input\n              id="party-members"\n              name="party-members"\n              type="number"\n              value="${this.partyMembers}">\n          </div>\n          ${this.getLootList()}\n          <div>\n            <label for="new-currency-item-field">\n              New Loot Item\n            </label>\n            <input\n              id="new-currency-item-field"\n              name="new-currency-item-field"\n              placeholder="Name..."\n              type="text"\n              value=""/>\n            <button\n              id="add-currency-button"\n              name="add-currency-button"\n              type="button">\n              +\n            </button>\n            <button\n              id="submit-calculate"\n              name="submit-calculate"\n              type="button">\n              Calculate\n            </button>\n          </div>\n        </form>\n        <h2>Random Loot Generator</h2>\n        <form>\n          <div>\n            <label>\n              Party Members\n            </label>\n            <input\n              id="random-loot-party-members-field"\n              name="random-loot-party-members-field"\n              type="number"\n              value="0"/>\n          </div>  \n          <div>\n            <label>\n              CR\n            </label>\n            <input\n              id="random-loot-cr-field"\n              name="random-loot-cr-field"\n              type="number"\n              value="0"/>\n          </div>\n          <div>\n            <button\n              id="submit-random-loot"\n              name="submit-random-loot"\n              type="button">\n              Calculate Random Loot\n            </button>\n          </div>\n        </form>\n      </div>\n    `;this.el.innerHTML=e,this.registerAddButton(),this.registerRandomLootButton(),this.registerSubmitButton()}}class y extends FormApplication{chatMessageComponent;currencyFormComponent;constructor(t,n){super(t,n);const m=[{name:r,total:0},{name:u,total:0},{name:o,total:0},{name:a,total:0},{name:s,total:0}];this.currencyFormComponent=new h(0,m,((t,n)=>{const m=new e(t,n).render();ChatMessage.create({speaker:{alias:"Foundry VTT Currency"},content:m})}))}activateListeners(e){super.activateListeners(e);const t=e[0];this.currencyFormComponent.el=t,this.currencyFormComponent.render()}async _updateObject(){}}window.MyFormApplication=y,Hooks.on("getSceneControlButtons",(e=>{((e,t)=>{const n=e.find((e=>"notes"===e.name));n?.tools&&n.tools.push({button:!0,icon:"fas fa-coins",name:"currency",onClick:()=>{new y({},{closeOnSubmit:!1,height:650,id:"foundry-vtt-currency-application",popOut:!0,resizable:!0,template:"modules/foundryvtt-currency/templates/main.html",title:"Foundry VTT Currency",width:800}).render(!0)},title:"Currency"})})(e)}))})();